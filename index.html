<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Thai Circle</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap"
    rel="stylesheet">

  <!-- React (UMD) -->
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script crossorigin
    src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>

  <style>
    :root {
      --primary: #0ea5e9;
      --primary-dark: #0284c7;
      --secondary: #6366f1;
      --accent: #f43f5e;
      --background: #f8fafc;
      --surface: #ffffff;
      --text-main: #0f172a;
      --text-muted: #64748b;
      --border: #e2e8f0;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    /* Background Slideshow */
    .bg-slideshow {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      overflow: hidden;
    }

    .bg-slide {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-size: cover;
      background-position: center;
      opacity: 0;
      animation: fadeSlide 15s infinite;
    }

    .bg-slide:nth-child(1) {
      background-image: url('https://images.unsplash.com/photo-1552465011-b4e21bf6e79a?q=80&w=2560&auto=format&fit=crop');
      animation-delay: 0s;
    }

    .bg-slide:nth-child(2) {
      background-image: url('https://images.unsplash.com/photo-1508009603885-50cf7c579365?q=80&w=2560&auto=format&fit=crop');
      animation-delay: 5s;
    }

    .bg-slide:nth-child(3) {
      background-image: url('https://images.unsplash.com/photo-1528181304800-259b08848526?q=80&w=2560&auto=format&fit=crop');
      animation-delay: 10s;
    }

    .bg-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.4);
      backdrop-filter: blur(4px);
    }

    @keyframes fadeSlide {
      0% {
        opacity: 0;
        transform: scale(1);
      }

      5% {
        opacity: 1;
      }

      33% {
        opacity: 1;
      }

      38% {
        opacity: 0;
        transform: scale(1.05);
      }

      100% {
        opacity: 0;
      }
    }

    body {
      font-family: 'Outfit', sans-serif;
      min-height: 100vh;
      padding: 2rem 1rem;
      color: var(--text-main);
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
    }

    .header {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      margin-bottom: 3rem;
      gap: 1.5rem;
      text-align: center;
    }

    .title-container {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
    }

    h1 {
      font-size: 3.5rem;
      font-weight: 800;
      color: white;
      text-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      letter-spacing: -0.03em;
      margin: 0;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.875rem 1.75rem;
      border-radius: 9999px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      font-size: 1rem;
      backdrop-filter: blur(8px);
    }

    .btn-primary {
      background: rgba(255, 255, 255, 0.9);
      color: var(--primary-dark);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      background: white;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
    }

    .btn-secondary {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    .btn-sm {
      padding: 0.5rem 1rem;
      font-size: 0.875rem;
    }

    .form-container {
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(16px);
      padding: 2.5rem;
      border-radius: 2rem;
      border: 1px solid rgba(255, 255, 255, 0.6);
      margin-bottom: 2rem;
      box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.15);
      animation: slideDown 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .form-title {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 1.5rem;
      color: var(--text-main);
      text-align: center;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    label {
      display: block;
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--text-muted);
      margin-bottom: 0.5rem;
      margin-left: 0.5rem;
    }

    input,
    select {
      width: 100%;
      padding: 1rem 1.5rem;
      border: 1px solid transparent;
      border-radius: 9999px;
      font-size: 1rem;
      background: rgba(255, 255, 255, 0.6);
      backdrop-filter: blur(4px);
      transition: all 0.2s ease;
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.02);
    }

    input:focus,
    select:focus {
      outline: none;
      background: white;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      border-color: var(--primary);
    }

    .city-row {
      background: rgba(255, 255, 255, 0.5);
      padding: 1.5rem;
      border-radius: 1.5rem;
      border: 1px solid rgba(255, 255, 255, 0.3);
      margin-bottom: 1rem;
    }

    .city-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    @media (min-width: 768px) {
      .city-grid {
        grid-template-columns: 2fr 1fr 1fr;
      }
    }

    .city-row-container {
      display: flex;
      gap: 1rem;
      align-items: start;
    }

    .city-row-container>div:first-child {
      flex: 1;
    }

    .btn-add-city {
      color: var(--primary);
      font-weight: 600;
      margin-top: 1rem;
      background: none;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      border-radius: 9999px;
      transition: background 0.2s;
    }

    .btn-add-city:hover {
      background: rgba(14, 165, 233, 0.1);
    }

    .btn-group {
      display: flex;
      gap: 1rem;
      margin-top: 2rem;
      justify-content: center;
    }

    .traveler-card {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(12px);
      border-radius: 1.5rem;
      border: 1px solid rgba(255, 255, 255, 0.5);
      padding: 2rem;
      margin-bottom: 1.5rem;
      transition: all 0.3s ease;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
    }

    .traveler-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
      background: rgba(255, 255, 255, 0.95);
    }

    .traveler-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 1.25rem;
    }

    .traveler-name {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 0.25rem;
      color: var(--text-main);
    }

    .traveler-interests {
      color: var(--text-muted);
      font-size: 0.95rem;
    }

    .action-buttons {
      display: flex;
      gap: 0.5rem;
    }

    .btn-icon {
      background: rgba(0, 0, 0, 0.05);
      border: none;
      cursor: pointer;
      padding: 0.5rem;
      border-radius: 0.75rem;
      color: var(--text-muted);
      transition: all 0.2s;
    }

    .btn-icon:hover {
      background: rgba(0, 0, 0, 0.1);
      color: var(--text-main);
    }

    .city-card {
      background: rgba(248, 250, 252, 0.5);
      padding: 1rem;
      border-radius: 1rem;
      border: 1px solid rgba(0, 0, 0, 0.05);
      margin-bottom: 0.75rem;
    }

    .city-name {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: var(--primary-dark);
      font-weight: 600;
      font-size: 1rem;
      margin-bottom: 0.25rem;
    }

    .city-dates {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: var(--text-muted);
      font-size: 0.875rem;
    }

    .overlap-container {
      background: #f0fdf4;
      border: 1px solid #bbf7d0;
      border-radius: 1rem;
      padding: 1.25rem;
      margin-top: 1.25rem;
    }

    .overlap-header {
      font-weight: 600;
      color: #15803d;
      margin-bottom: 0.75rem;
      font-size: 0.95rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .overlap-item {
      background: white;
      padding: 0.75rem;
      border-radius: 0.75rem;
      border: 1px solid #bbf7d0;
      margin-bottom: 0.5rem;
    }

    .footer {
      margin-top: 4rem;
      text-align: center;
      font-size: 0.95rem;
      color: rgba(255, 255, 255, 0.9);
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(12px);
      padding: 1rem 2rem;
      border-radius: 9999px;
      display: inline-block;
      position: relative;
      left: 50%;
      transform: translateX(-50%);
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .footer p {
      margin-bottom: 0.25rem;
    }

    svg {
      width: 20px;
      height: 20px;
    }

    .icon-sm {
      width: 16px;
      height: 16px;
    }

    .icon-lg {
      width: 64px;
      height: 64px;
    }

    .status-line {
      margin-top: 1rem;
      color: rgba(255, 255, 255, 0.8);
      font-size: 0.9rem;
      text-align: center;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
    }

    /* Mobile Responsiveness */
    @media (max-width: 640px) {
      body {
        padding: 1rem 0.5rem;
      }

      h1 {
        font-size: 2.5rem;
      }

      .header {
        margin-bottom: 2rem;
      }

      .form-container {
        padding: 1.5rem;
        border-radius: 1.5rem;
      }

      .city-row {
        padding: 1rem;
      }

      .city-grid {
        gap: 0.75rem;
      }

      .btn {
        width: 100%;
        justify-content: center;
      }

      .btn-group {
        flex-direction: column;
        gap: 0.75rem;
      }

      .footer {
        width: 90%;
        padding: 1rem;
        font-size: 0.85rem;
      }

      .traveler-card {
        padding: 1.5rem;
      }

      .traveler-header {
        flex-direction: column;
        gap: 1rem;
      }

      .action-buttons {
        width: 100%;
        justify-content: flex-end;
      }
    }
  </style>

  <!-- Firebase Firestore (Module) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
    import {
      getFirestore,
      collection,
      addDoc,
      doc,
      updateDoc,
      deleteDoc,
      onSnapshot,
      query,
      orderBy,
      serverTimestamp
    } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

    // Your config (keep as-is)
    const firebaseConfig = {
      apiKey: "AIzaSyBzhZTRzOYU6h6AY3ChT7Gg97EyFD5wfi4",
      authDomain: "thailand-9c504.firebaseapp.com",
      projectId: "thailand-9c504",
      storageBucket: "thailand-9c504.firebasestorage.app",
      messagingSenderId: "837514191642",
      appId: "1:837514191642:web:69d068b4024c659dffc2a3",
      measurementId: "G-4W98BY2T98"
    };

    try {
      console.log("[Firebase] Starting init...");

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      const travelersCol = collection(db, "travelers");

      window.dbApi = {
        listenTravelers: (cb, onError) => {
          const q = query(travelersCol, orderBy("createdAt", "desc"));
          return onSnapshot(
            q,
            (snap) => cb(snap.docs.map(d => ({ id: d.id, ...d.data() }))),
            (err) => onError && onError(err)
          );
        },
        addTraveler: (payload) =>
          addDoc(travelersCol, {
            ...payload,
            createdAt: serverTimestamp(),
            updatedAt: serverTimestamp()
          }),
        updateTraveler: (id, payload) =>
          updateDoc(doc(db, "travelers", id), {
            ...payload,
            updatedAt: serverTimestamp()
          }),
        deleteTraveler: (id) => deleteDoc(doc(db, "travelers", id))
      };

      // Ready flag (so React can wait safely)
      window.firebaseReady = true;

      console.log("[Firebase] Ready. dbApi attached:", window.dbApi);
    } catch (err) {
      window.firebaseReady = false;
      window.firebaseInitError = err;
      console.error("[Firebase] Init failed:", err);
    }
  </script>

</head>

<body>
  <div class="bg-slideshow">
    <div class="bg-slide"></div>
    <div class="bg-slide"></div>
    <div class="bg-slide"></div>
    <div class="bg-overlay"></div>
  </div>
  <div id="root"></div>

  <script>
    const { useState, useEffect, createElement: e } = React;

    const THAILAND_CITIES = [
      'Bangkok', 'Chiang Mai', 'Phuket', 'Pattaya', 'Krabi', 'Koh Samui',
      'Koh Phi Phi', 'Ayutthaya', 'Hua Hin', 'Koh Tao', 'Koh Phangan',
      'Chiang Rai', 'Pai', 'Railay Beach', 'Kanchanaburi', 'Sukhothai',
      'Khao Lak', 'Koh Lanta', 'Koh Chang', 'Cha-Am'
    ].sort();

    const Icons = {
      Plus: () => e('svg', { viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: '2' },
        e('line', { x1: '12', y1: '5', x2: '12', y2: '19' }),
        e('line', { x1: '5', y1: '12', x2: '19', y2: '12' })
      ),
      X: () => e('svg', { viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: '2' },
        e('line', { x1: '18', y1: '6', x2: '6', y2: '18' }),
        e('line', { x1: '6', y1: '6', x2: '18', y2: '18' })
      ),
      Users: () => e('svg', { viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: '2' },
        e('path', { d: 'M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2' }),
        e('circle', { cx: '9', cy: '7', r: '4' }),
        e('path', { d: 'M23 21v-2a4 4 0 0 0-3-3.87' }),
        e('path', { d: 'M16 3.13a4 4 0 0 1 0 7.75' })
      ),
      MapPin: () => e('svg', { viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: '2' },
        e('path', { d: 'M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z' }),
        e('circle', { cx: '12', cy: '10', r: '3' })
      ),
      Calendar: () => e('svg', { className: 'icon-sm', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: '2' },
        e('rect', { x: '3', y: '4', width: '18', height: '18', rx: '2', ry: '2' }),
        e('line', { x1: '16', y1: '2', x2: '16', y2: '6' }),
        e('line', { x1: '8', y1: '2', x2: '8', y2: '6' }),
        e('line', { x1: '3', y1: '10', x2: '21', y2: '10' })
      ),
      Trash: () => e('svg', { viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: '2' },
        e('polyline', { points: '3 6 5 6 21 6' }),
        e('path', { d: 'M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2' })
      ),
      Edit: () => e('svg', { viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: '2' },
        e('path', { d: 'M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7' }),
        e('path', { d: 'M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z' })
      )
    };

    function waitForDbApi(maxMs) {
      const start = Date.now();
      return new Promise((resolve, reject) => {
        const tick = () => {
          if (window.firebaseInitError) return reject(window.firebaseInitError);
          if (window.firebaseReady && window.dbApi) return resolve(window.dbApi);
          if (Date.now() - start > maxMs) return reject(new Error("Firebase did not become ready in time."));
          setTimeout(tick, 50);
        };
        tick();
      });
    }


    function TravelOverlapApp() {
      const [travelers, setTravelers] = useState([]);
      const [showForm, setShowForm] = useState(false);
      const [editingId, setEditingId] = useState(null);
      const [loading, setLoading] = useState(true);
      const [errorMsg, setErrorMsg] = useState("");

      const [formData, setFormData] = useState({
        name: '',
        interests: '',
        cities: [{ city: '', startDate: '', endDate: '' }]
      });

      useEffect(() => {
        let unsubscribe = null;

        (async () => {
          try {
            const dbApi = await waitForDbApi(8000);

            unsubscribe = dbApi.listenTravelers(
              (rows) => {
                const normalized = (rows || []).map(r => ({
                  id: r.id,
                  name: r.name || "",
                  interests: r.interests || "",
                  cities: Array.isArray(r.cities) ? r.cities : []
                }));
                setTravelers(normalized);
                setLoading(false);
              },
              (err) => {
                console.error("Firestore listener error:", err);
                setErrorMsg("Firestore error: " + (err?.message || String(err)));
                setLoading(false);
              }
            );
          } catch (err) {
            console.error("Firebase init error:", err);
            setErrorMsg("Firebase init failed: " + (err?.message || String(err)));
            setLoading(false);
          }
        })();

        return () => {
          if (unsubscribe) unsubscribe();
        };
      }, []);

      const addCityField = () => {
        setFormData({
          ...formData,
          cities: [...formData.cities, { city: '', startDate: '', endDate: '' }]
        });
      };

      const removeCityField = (index) => {
        const newCities = formData.cities.filter((_, i) => i !== index);
        setFormData({ ...formData, cities: newCities });
      };

      const updateCity = (index, field, value) => {
        const newCities = [...formData.cities];
        newCities[index][field] = value;
        setFormData({ ...formData, cities: newCities });
      };

      const handleSubmit = async () => {
        if (!formData.name) {
          alert('Please enter your name');
          return;
        }

        const validCities = formData.cities.filter(c => c.city && c.startDate && c.endDate);
        if (validCities.length === 0) {
          alert('Please add at least one complete city with dates');
          return;
        }

        try {
          const dbApi = await waitForDbApi(8000);

          if (editingId) {
            await dbApi.updateTraveler(editingId, {
              name: formData.name,
              interests: formData.interests,
              cities: validCities
            });
            setEditingId(null);
          } else {
            await dbApi.addTraveler({
              name: formData.name,
              interests: formData.interests,
              cities: validCities
            });
          }

          setFormData({ name: '', interests: '', cities: [{ city: '', startDate: '', endDate: '' }] });
          setShowForm(false);
        } catch (err) {
          console.error("Save failed:", err);
          alert("Save failed: " + (err?.message || String(err)));
        }
      };

      const handleEdit = (traveler) => {
        setFormData({
          name: traveler.name,
          interests: traveler.interests || '',
          cities: traveler.cities || [{ city: '', startDate: '', endDate: '' }]
        });
        setEditingId(traveler.id);
        setShowForm(true);
      };

      const handleCancel = () => {
        setFormData({ name: '', interests: '', cities: [{ city: '', startDate: '', endDate: '' }] });
        setEditingId(null);
        setShowForm(false);
      };

      const handleDelete = async (id) => {
        if (!confirm('Are you sure you want to delete this entry?')) return;

        try {
          const dbApi = await waitForDbApi(8000);
          await dbApi.deleteTraveler(id);
        } catch (err) {
          console.error("Delete failed:", err);
          alert("Delete failed: " + (err?.message || String(err)));
        }
      };

      const findOverlapsForCity = (travelerId, city, startDate, endDate) => {
        const start = new Date(startDate);
        const end = new Date(endDate);
        const overlaps = [];

        travelers.forEach(traveler => {
          if (traveler.id === travelerId) return;

          const cities = traveler.cities || [];
          cities.forEach(tc => {
            if (tc.city === city &&
              new Date(tc.startDate) <= end &&
              new Date(tc.endDate) >= start) {
              overlaps.push({
                name: traveler.name,
                interests: traveler.interests,
                startDate: tc.startDate,
                endDate: tc.endDate
              });
            }
          });
        });

        return overlaps;
      };

      const formatDate = (dateString) => {
        const date = new Date(dateString);
        return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
      };

      const getOverlapPeriod = (start1, end1, start2, end2) => {
        const s1 = new Date(start1);
        const e1 = new Date(end1);
        const s2 = new Date(start2);
        const e2 = new Date(end2);

        const overlapStart = s1 > s2 ? s1 : s2;
        const overlapEnd = e1 < e2 ? e1 : e2;

        return `${formatDate(overlapStart)} - ${formatDate(overlapEnd)}`;
      };

      return e('div', { className: 'container' },
        e('div', { className: 'card' },
          e('div', { className: 'header' },
            e('div', { className: 'title-container' },
              e(Icons.Users),
              e('h1', null, 'Thai Circle')
            ),
            e('button', {
              className: 'btn btn-primary',
              onClick: () => {
                setEditingId(null);
                setFormData({ name: '', interests: '', cities: [{ city: '', startDate: '', endDate: '' }] });
                setShowForm(!showForm);
              }
            },
              e(Icons.Plus),
              'Add My Trips'
            )
          ),


          loading && e('div', { className: 'status-line' }, 'Loading shared data from Firestore...'),
          errorMsg && e('div', { className: 'status-line', style: { color: '#b91c1c' } }, errorMsg),

          showForm && e('div', { className: 'form-container' },
            e('div', { className: 'form-title' }, editingId ? 'Edit Your Trips' : 'Add Your Trips'),
            e('div', { className: 'form-group' },
              e('label', null, 'Your Name *'),
              e('input', {
                type: 'text',
                value: formData.name,
                onChange: (ev) => setFormData({ ...formData, name: ev.target.value }),
                placeholder: 'Enter your name'
              })
            ),
            e('div', { className: 'form-group' },
              e('label', null, 'Interests'),
              e('input', {
                type: 'text',
                value: formData.interests,
                onChange: (ev) => setFormData({ ...formData, interests: ev.target.value }),
                placeholder: 'e.g. Food tours, temples, hiking, nightlife'
              })
            ),
            e('div', { className: 'form-group' },
              e('label', null, 'Cities & Dates *'),
              formData.cities.map((cityData, index) =>
                e('div', { key: index, className: 'city-row' },
                  e('div', { className: 'city-row-container' },
                    e('div', null,
                      e('div', { className: 'city-grid' },
                        e('select', {
                          value: cityData.city,
                          onChange: (ev) => updateCity(index, 'city', ev.target.value)
                        },
                          e('option', { value: '' }, 'Select city'),
                          THAILAND_CITIES.map(city =>
                            e('option', { key: city, value: city }, city)
                          )
                        ),
                        e('input', {
                          type: 'date',
                          value: cityData.startDate,
                          onChange: (ev) => updateCity(index, 'startDate', ev.target.value)
                        }),
                        e('input', {
                          type: 'date',
                          value: cityData.endDate,
                          onChange: (ev) => updateCity(index, 'endDate', ev.target.value)
                        })
                      )
                    ),
                    formData.cities.length > 1 && e('button', {
                      className: 'btn-icon btn-delete btn-sm',
                      onClick: () => removeCityField(index)
                    }, e(Icons.X))
                  )
                )
              ),
              e('button', { className: 'btn-add-city', onClick: addCityField },
                e(Icons.Plus),
                'Add Another City'
              )
            ),
            e('div', { className: 'btn-group' },
              e('button', { className: 'btn btn-primary', onClick: handleSubmit },
                editingId ? 'Update Trips' : 'Save All Trips'
              ),
              e('button', { className: 'btn btn-secondary', onClick: handleCancel }, 'Cancel')
            )
          )
        ),

        (!loading && travelers.length === 0)
          ? e('div', { className: 'card empty-state' },
            e('div', { className: 'empty-icon' },
              e('svg', { className: 'icon-lg', viewBox: '0 0 24 24', fill: 'none', stroke: '#d1d5db', strokeWidth: '2' },
                e('path', { d: 'M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2' }),
                e('circle', { cx: '9', cy: '7', r: '4' }),
                e('path', { d: 'M23 21v-2a4 4 0 0 0-3-3.87' }),
                e('path', { d: 'M16 3.13a4 4 0 0 1 0 7.75' })
              )
            ),
            e('div', { className: 'empty-title' }, 'No travelers yet'),
            e('div', { className: 'empty-text' }, 'Click "Add My Trips" to share your travel plans!')
          )
          : travelers.map(traveler =>
            e('div', { key: traveler.id, className: 'traveler-card' },
              e('div', { className: 'traveler-header' },
                e('div', null,
                  e('div', { className: 'traveler-name' }, traveler.name),
                  traveler.interests && e('div', { className: 'traveler-interests' },
                    e('strong', null, 'Interests: '),
                    traveler.interests
                  )
                ),
                e('div', { className: 'action-buttons' },
                  e('button', { className: 'btn-icon btn-edit', onClick: () => handleEdit(traveler), title: 'Edit' },
                    e(Icons.Edit)
                  ),
                  e('button', { className: 'btn-icon btn-delete', onClick: () => handleDelete(traveler.id), title: 'Delete' },
                    e(Icons.Trash)
                  )
                )
              ),
              (traveler.cities || []).map((cityData, idx) => {
                const overlaps = findOverlapsForCity(traveler.id, cityData.city, cityData.startDate, cityData.endDate);
                return e('div', { key: idx, className: 'city-card' },
                  e('div', { className: 'city-name' }, e(Icons.MapPin), cityData.city),
                  e('div', { className: 'city-dates' }, e(Icons.Calendar),
                    `${formatDate(cityData.startDate)} - ${formatDate(cityData.endDate)}`
                  ),
                  overlaps.length > 0 && e('div', { className: 'overlap-container' },
                    e('div', { className: 'overlap-header' },
                      e(Icons.Users),
                      `Overlapping with ${overlaps.length} traveler${overlaps.length > 1 ? 's' : ''}:`
                    ),
                    overlaps.map((other, oidx) =>
                      e('div', { key: oidx, className: 'overlap-item' },
                        e('div', { className: 'overlap-name-date' },
                          e('span', { className: 'overlap-name' }, other.name),
                          e('span', { className: 'overlap-dates' },
                            getOverlapPeriod(cityData.startDate, cityData.endDate, other.startDate, other.endDate)
                          )
                        ),
                        other.interests && e('div', { className: 'overlap-interests' }, 'Interests: ', other.interests)
                      )
                    )
                  )
                );
              })
            )
          ),

        e('div', { className: 'footer' },
          e('p', null, e('strong', null, 'Tip: '), 'Share this link with other solo travelers to find overlap buddies!'),
          e('p', null, 'Data is stored in Firebase Firestore with live updates.')
        )
      );
    }

    ReactDOM.render(React.createElement(TravelOverlapApp), document.getElementById('root'));
  </script>
</body>

</html>